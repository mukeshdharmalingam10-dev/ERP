name: FTP Deploy (cURL)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Upload Files via Curl
      run: |
        echo "Starting Deployment..."

        # Local directory containing files to upload (from repo)
        LOCAL_DIR="./public"

        # Remote directory path on server
        REMOTE_DIR="/public_html/custom_erp/"

        # Loop through all files under LOCAL_DIR
        find "$LOCAL_DIR" -type f | while read FILE; do

          # Build remote destination path
          REMOTE_PATH="$REMOTE_DIR${FILE#$LOCAL_DIR/}"

          echo "Uploading: $FILE â†’ $REMOTE_PATH"

          # Upload via FTPS, ignore certificate issues (shared hosting)
          curl -T "$FILE" \
            "ftps://${{ secrets.FTP_SERVER }}$REMOTE_PATH" \
            --user "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
            --ftp-ssl --insecure
        done

        echo "Deployment completed!"
